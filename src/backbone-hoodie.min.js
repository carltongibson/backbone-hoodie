/*! backbone-hoodie 22-11-2013 */
!function(a,b){"use strict";if("object"==typeof exports){var c=require("backbone"),d=require("hoodie");module.exports=b(c,d)}else"function"==typeof define&&define.amd?define(["backbone","hoodie"],b):a.Backbone.hoodie=b(a.Backbone,a.Hoodie)}(this,function(a,b){"use strict";return a.connect=function(c){a.hoodie=new b(c)},a.sync=function(b,c,d){var e,f,g,h;return f=c.id,e=c.attributes,h=c.type,h=h||(h=c.model.prototype.type),g=function(){switch(b){case"read":return f?a.hoodie.store.find(h,f):a.hoodie.store.findAll(h);case"create":return a.hoodie.store.add(h,e);case"update":return a.hoodie.store.update(h,f,e);case"delete":return a.hoodie.store.remove(h,f)}}(),d.success&&g.done(d.success),d.error?g.fail(d.error):void 0},a.Model.prototype.merge=function(a){this.set(a,{remote:!0})},a.Collection.prototype.initialize=function(){var b,c=this;this.model&&(b=this.model.prototype.type,this.fetch(),b&&(a.hoodie.store.on("add:"+b,function(a){c.eventAdd(a)}),a.hoodie.remote.on("add:"+b,function(a){c.eventAdd(a)}),a.hoodie.store.on("remove:"+b,function(a){c.eventRemove(a)}),a.hoodie.remote.on("remove:"+b,function(a){c.eventRemove(a)}),a.hoodie.store.on("update:"+b,function(a){c.eventUpdate(a)}),a.hoodie.remote.on("update:"+b,function(a){c.eventUpdate(a)})))},a.Collection.prototype.eventAdd=function(a){this.add(a)},a.Collection.prototype.eventRemove=function(a){var b,c;return b=a.id,null!==(c=this.get(b))?c.destroy():void 0},a.Collection.prototype.eventUpdate=function(a){var b,c;return b=a.id,null!==(c=this.get(b))?c.merge(a):void 0},a});